# Fire-ViT Base Configuration

# Model Configuration
model:
  name: "Fire-ViT"
  input_size: [640, 640]
  patch_size: 16
  stride: 8
  in_channels: 3

  # Hierarchical stages
  embed_dims: [192, 384, 768, 768]
  num_heads: [8, 12, 16, 16]
  num_blocks: [2, 2, 6, 2]
  mlp_ratios: [4, 4, 4, 4]

  # Deformable attention
  num_sampling_points: 4

  # Regularization
  drop_rate: 0.0
  attn_drop_rate: 0.0
  drop_path_rate: 0.3

  # Detection head
  fpn_channels: 256
  num_classes: 3  # background + fire + smoke
  fpn_strides: [8, 16, 32, 64]  # Strides for each FPN level

# Training Configuration
training:
  epochs: 7
  batch_size: 32
  accumulation_steps: 4
  effective_batch_size: 128  # batch_size * accumulation_steps

  # Optimizer
  optimizer: "adamw"
  base_lr: 5.0e-5  # Reduced from 1e-4 for stability
  weight_decay: 0.05

  # Learning rate schedule
  warmup_epochs: 5
  warmup_lr: 1.0e-6
  min_lr: 1.0e-6
  lr_schedule: "cosine"

  # EMA
  use_ema: true
  ema_decay: 0.9999

  # Mixed precision
  use_amp: true  # Now safe with fp32 casting for exp() and division ops

  # Gradient clipping
  clip_grad_norm: 1.0

  # Augmentation (disabled initially for gradient stability)
  use_mixup: false
  mixup_alpha: 0.2
  use_cutmix: false
  cutmix_alpha: 1.0
  use_mosaic: false
  mosaic_prob: 0.5

# Loss Configuration
loss:
  # Loss weights
  focal_weight: 1.0
  ciou_weight: 0.5  # Dramatically reduced for gradient stability with L1 loss
  attention_weight: 0.0  # Disabled initially for stability
  dice_weight: 0.5  # Reduced from 2.0 for stability
  auxiliary_weight: 0.5

  # Focal loss parameters
  focal_alpha: 0.25
  focal_gamma: 2.0

  # Label smoothing
  label_smoothing: 0.1

# Data Configuration
data:
  dataset_name: "Roboflow-Fire"
  dataset_path: "./data/fire-detection/fire-and-smoke-detection-2"
  
  # Annotation paths
  train_annotation: "./data/fire-detection/fire-and-smoke-detection-2/train/_annotations.coco.json"
  val_annotation: "./data/fire-detection/fire-and-smoke-detection-2/valid/_annotations.coco.json"
  test_annotation: "./data/fire-detection/fire-and-smoke-detection-2/test/_annotations.coco.json"
  
  # Image directories
  train_images: "./data/fire-detection/fire-and-smoke-detection-2/train"
  val_images: "./data/fire-detection/fire-and-smoke-detection-2/valid"
  test_images: "./data/fire-detection/fire-and-smoke-detection-2/test"


  # # Splits
  # train_split: 0.8
  # val_split: 0.1
  # test_split: 0.1

  # Data loading
  num_workers: 8
  pin_memory: true
  prefetch_factor: 2

  # Image preprocessing
  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]

# Logging & Checkpointing
logging:
  log_interval: 50  # steps
  val_interval: 1  # epochs
  save_interval: 10  # epochs

  # Experiment tracking
  use_tensorboard: true
  use_wandb: false
  wandb_project: "fire-vit"

  # Checkpoints
  checkpoint_dir: "./checkpoints"
  save_best_only: false
  max_checkpoints: 5

# Evaluation
evaluation:
  iou_thresholds: [0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95]
  conf_threshold: 0.001
  nms_threshold: 0.6
  max_detections: 100

# Hardware
device: "cuda"  # cuda, cpu, mps
seed: 42
deterministic: false
